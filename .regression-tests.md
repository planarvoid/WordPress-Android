# Exploratory testing
- [ ] Grab your headphones and use our app for 30 minutes!
- [ ] Control playback using headphones built-in controls. Should be able to play/stop/move back and forth in any playlist
- [ ] Run the app on a pre-lollipop device/emulator and check for any crashes or strange UI. See http://go/android-devices


# Memory leak testing
- [ ] Check for memory leaks using LeakCanary
   - Check out the release branch
   - Install a debug build on a phone or emulator
   - Go to the main screens in the app and change orientation, waiting ~5 seconds after each change to detect a memory leak


# Logging out and account switching

Tip: To see available memory on your device, run `adb shell df /data`
- [ ] Old data is removed when logging in as a different user
    - Sign in as a SoundCloud Go user and sync some tracks offline 
    - Log back in as another user
- [ ] Removing account via the system account settings triggers app logout and removes data
    - Sign in as a SoundCloud Go user and sync some tracks offline 
    - Remove the account from the account manager


# Upgrade from Play Store
- [ ] Install existing release from the Play Store
- [ ] Offline some tracks
- [ ] Upgrade using adb `adb install -r <path to new apk>`
- [ ] The new version installs cleanly over the existing version from the Play Store
- [ ] Offline tracks downloaded on previous version remain available after upgrade


# Payment flow

 - Check out the `release` branch
 - Open `WebPaymentIntegrationTest` in Android Studio
 - Launch an emulator

### Mid-tier checkout
 - [ ] Check that `testEndToEndMidTierPurchase` passes
 - [ ] Sign in [1] and confirm Go status (offline content, still gets previews & Go+ upsells)
 - [ ] Reset subscription [2]

### High-tier checkout
 - [ ] Check that `testEndToEndHighTierPurchase` passes
 - [ ] Sign in [1] and confirm Go+ status (playable premium tracks, no upsells)
 - [ ] Reset subscription [2]

---

#### [1] Sign in with test user
 - Open app in the emulator after the test run has completed
 - Sign in with u:`scandsubscribe` p:`s0undcl0ud`

#### [2] Reset test user subscription status
##### Via Sonar (only if you have the payments role)
 1) Open http://sonar.soundcloud.com/users/scandsubscribe/purchases
 1) Click "Terminate" under "Staging payment history"
##### Via CURL
 1) Connect to the `s-cloud` VPN
 1) Open the "Shared-Mobile" folder in LastPass
 1) Run the command from the notes section of `Android Automated Payment User`
 1) Go to the above link and check that there is no active subscription in "Staging payment history"


# Offline error states and retry logic
Visiting each section and verifying that the offline behavior seems sensible, covering various possible scenarios including:
pull to refresh, loading first page and subsequent pages on/offline where applicable, and retrying once internet is back online

- [ ] Likes
- [ ] Playlist and albums
- [ ] Recently played
- [ ] Discovery - Single Content Card
- [ ] Discovery - Multiple Content Card


# Offline sync
- As a subscriber:
    - For a playlist that belongs to another user:
        - For unliked and unsynced playlist:
            - [ ] Clicking on the download icon will like and prepare the playlist for offline listening.
        - For liked and synced playlist:
            - [ ] Clicking on the download icon will remove the playlist from offline listening, but will keep the playlist liked.
            - [ ] Clicking on the like toggle will unlike and remove the playlist from offline listening.
    - For a playlist that belongs to the logged in user:
        - For unliked and unsynced playlist:
            - [ ] Clicking on the download icon will prepare the playlist for offline listening but will not like it.
        - For liked and synced playlist:
            - [ ] Clicking on the download icon will remove the playlist from offline listening, and will keep the playlist liked.
            - [ ] Clicking on the like toggle will unlike and will keep the playlist for offline listening.
- [ ] As a non-subscriber, clicking on the download icon shows the conversion modal.


# Offline sync on SD card

To see available memory on your device, run `adb shell df /data`
- [ ] Set up a device/AVD with an SD card with sufficient memory (1GB recommended):
    - [ ] Benchmark available memory before syncing any tracks (1)
    - [ ] As a subscriber, sync liked tracks or a playlist to device storage (this is the default storage location).
    - [ ] Benchmark available memory after tracks have synced (2)
    - [ ] Go to "Offline listening settings" and tap "Change storage location".
    - [ ] Select the "SD card" radio button, and tap "Ok, got it" on the "Change storage location?" dialog.
    - [ ] All tracks previously saved on device storage should now be re-downloaded to the SD card.
    - [ ] Benchmark available memory after tracks gave been re-downloaded (3)
    - [ ] Available disk memory should only decrease at benchmark 2. Benchmark 1 and 3 should be nearly equal


# Signup/login
Disclaimer: Do not perform these tests on your personal device, as you might need to remove your account from it. It is preferred to use a test device or emulator.

## Email
Note: you can use `yourname+something@soundcloud.com`

  - [ ] Sign up with email
    - [ ] Set profile image
    - [ ] Set user display name
  - [ ] Log in with email
  - [ ] Validate forgot password
     - [ ] Enter a valid email address, receive email on how to reset your password
     - [ ] Enter an invalid email (get creative!) and see the error toast that this email doesn't exist
  - [ ] Delete the account on [Sonar](http://sonar.soundcloud.com)
    - Look for the username -> click "View" -> gear button -> delete
    - [ ] Continue to interact with the app and verify that an unauthorized access dialog is presented

## Google
Prerequisite : A Google account for testing is setup on the device; you can use (username: `sclouder.mobile.test@gmail.com`, password: `SclouderTest1234`) or create a new one *from web*

  - [ ] Sign up with this account
  - [ ] Log in with this account
  - [ ] Sign up and log in by selecting from multiple Google accounts
    - Prerequisite : You need 2 Google accounts setup on your device.
  - [ ] Delete the account on [Sonar](http://sonar.soundcloud.com)
    - Look for the username -> click "View" -> gear button -> delete

## Facebook

Important for Facebook SDK and platform changes that might be getting released!

Note: you can now install Google apps on Genymotion 2.10 and above or use the Google emulator with Play Store

Prerequisite : You are signed in the Facebook app with a testing account; you can use (email: `soundcloud.facebook.tester2@gmail.com`, password: `TestFacebookYo!321`) or create a new one *from web*

  - [ ] Sign up with this account
  - [ ] Log in with this account
  - [ ] Delete the account on [Sonar](http://sonar.soundcloud.com)
    - Look for the username -> click "View" -> gear button -> delete


# Player
- [ ] Plays the track
- [ ] Scrubbing
- [ ] Share
- [ ] Repost
- [ ] Add comment
- [ ] Orientation change
- [ ] Go to likes, turn on airplane mode and start playing a non-downloaded song. A playback error should be shown in the player. For the actual test see `OfflinePlayerTest#testShowErrorWhenContentNotDownloaded`


# Google Cast
**To test the Chromecast**

  - Grab the Chromecast from the Safe
  - On your Macbook:
    - Connect your computer to an ethernet connection
    - [Turn your mac into a Wifi Hotspot](https://www.howtogeek.com/214053/how-to-turn-your-mac-into-a-wi-fi-hotspot/)  
  - On the Chromecast:
    - Find a monitor that has an HDMI input (preferably also an audio output jack, the old Dell monitors are ideal)
    - Connect the Chromecast to the HDMI port and a power source
    - Hook up your headphones / massive speakers to the audio output port
  - On your phone:
    - Download Google Home
    - Open Google Home and Setup the Chromecast to point to your Macbook's HotSpot
    - Connect your phone to your MacBook's Wifi so your phone and the Chromecast are on the same network
  - Cast it up!
- - -

- [ ] Cast from player and from a MenuItem from any Toolbar in the app
    - [ ] Check the track position is reflected on the TV
    - [ ] Check the player state (playing/paused) is reflected on the TV
- [ ] Disconnect cast should pause playback
    - [ ] Immediately after disconnection, clicking on the "resume" button should continue playback from the point where cast stopped playing
- [ ] Volume control
- [ ] Auto track change (while having the player on foreground)
- [ ] Player manual track change (skip next/previous)
- [ ] Notification track change (skip next/previous)
- [ ] Lockscreen track change (skip next/previous (in some devices you might be required to swipe down to expand the notification))
- [ ] **Multicasting**: perform an exploratory test (play/pause, skip, seek, changing play queues) while having more than one device connected to the same Chromecast and observe if everything is in sync


# Lockscreen/notification controls + widget
- [ ] Liking/unliking via widget updates player
- [ ] Liking/unliking via player updates widget
- [ ] Widget/lockscreen/notification controls update player
- [ ] Player controls update widget/lockscreen/notification


# Activity
- [ ] New follower
- [ ] Like
- [ ] Repost
- [ ] New comment
- [ ] Orientation change
- [ ] "X new notifications" pill on screen start. Tapping the pill scrolls to top and shows new notifications.


# Sound Stream
- [ ] Update
- [ ] Orientation change
- [ ] "X new posts" pill on app start. Tapping the pill scrolls to top and shows new posts.


# Record
- [ ] record track
- [ ] edit recording
- [ ] play recording in record window
- [ ] see the recorded track in your profile -> Sounds


# Ads

**NOTE:** The availability of promoted stream items depends on several factors. Builds talking to api-mobile-alpha (e.g. if you manually build devDebug flavor from the release branch)
will always get them. In beta and prod environments, frequency caps apply as well as geographic region.
The latter can be circumvented by being in the `cloud_people` feature group.

Some things have to be tested manually, using a free-tier user that has items in the stream please check that:

- [ ] Promoted track is shown in stream
- [ ] Promoted playlist is shown in stream (pull to refresh the stream)
- [ ] Ad event tracking sent to EventLogger & Promoted (400 response is OK)
- [ ] Vertical video ads (deep-link [here](https://soundcloud.com/scandroidad1/sets/vertical-video-ad)) change & lock the player orientation to portrait
- [ ] Player orientation is no longer locked once ad has been skipped


# Tracking and Settings
1. Set up an emulator / Genymotion with a pre-Marshmallow device (you can also use a device as long as it is pre Marshmallow) 
2. Set it up with [Charles proxy]( https://github.com/soundcloud/android-listeners/wiki/Debugging-Network-requests-with-Charles-from-your-Phone---Tablet) 
3. Enable the "Flush EventLogger instantly" option in the developer menu 
4. Verify that the following requests are made:
    - [ ] Event tracking to EventGateway (check requests to https://telemetry.soundcloud.com)
    - [ ] Event tracking to AppBoy (check requests to https://serpens.iad.appboy.com:443)
    - [ ] Adjust tracking (check request to https://app.adjust.com:443, after fresh install of the app)
    - [ ] Changing users will change the user ID we send with Analytics requests (look at "user" for EventGateway)
    - [ ] Requests to [b.scorecardresearch.com]
    - [ ] Requests to Crashlytics [e.crashlytics.com]
    - [ ] Turning off Analytics and Crashlogs in `Settings > Basic Settings` and restarting the app doesn't show the requests to ScoreCard and Crashlytics
    - [ ] Sanity check by turning the settings back on, restarting the app and the requests should appear again
5. Clearing Cache
    - [ ] `Settings > Basic Settings > Clear application cache` shows "Cache cleared success message"


# Age Gating
You can use the test users 'underage@sc.com' (pw: underage) and 'soundcloud.manual.ageless@tests.soundcloud' (pw: SoundCloudTest2016) to perform these tests
**Please don't change their ages so we can keep using them specifically for this test**

- [ ] With an user which has an age inferior to 18 years old (depending on the country this might change, for example, 14 in Germany), attempt to follow the [annoymouse](http://sonar.soundcloud.com/users/annoymouse?query=32326572) user. You should not be able to follow the user and will be shown a notification.
- [ ] With an user which does not have its age defined, attempt to follow the [annoymouse](http://sonar.soundcloud.com/users/annoymouse?query=32326572) user. You should not be able to follow the user and will be prompted for your age (do not fill out the age data please!).


# Dev features
- [ ] Login with a non `cloud_people` user and verify the dev drawer is not there.
