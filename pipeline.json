{
  "stages": [
    {
      "name": "build",
      "jobs": [
        [
          {
            "compile": {
              "artifacts": [
                "app/build/outputs/apk/soundcloud-android-*-${PIPELINE_VERSION}-debug-*.apk"
              ],
              "cmd": "./gradlew buildDebug",
              "plugins": {
                "androidLint": {
                "failedTotalHigh": 0,
                "failedTotalNormal": 0,
                "pattern": "app/build/outputs/lint-results-prodDebug.xml"
              },
                "findbugs": {
                  "pattern": "app/build/reports/findbugs/findbugs.xml"
              },
                "pmd": {
                  "pattern": "app/build/reports/pmd/pmd.xml"
              },
                "taskPublisher": {
                  "excludePattern": "app/target/**/*",
                  "pattern": "app/**/*.*"
              },
                "violations": {
                  "checkstyle": {
                      "pattern": "app/build/reports/checkstyle/checkstyle.xml"
                  }
                }
              }
            }
          },
          {
            "compile_test_apk": {
              "cmd": "./gradlew clean assembleAcceptanceTest downloadNetworkManagerApkCI",
              "artifacts": [
                "app/build/outputs/apk/*androidTest*.apk",
                "app/build/outputs/apk/androidnetworkmanager-*.apk"
              ]
            }
          }
        ]
      ],
      "next-stages": [
        "test",
        "performances",
        "deploy",
        "statistics",
        "nightly_acceptance_tests"
      ]
    },
    {
      "name": "test",
      "jobs": [
        [
          {
            "unit_tests": {
              "cmd": "./gradlew clean runUnitTests",
              "no-clean": true,
              "test-reports": "**/build/test-results/**/*.xml",
              "plugins": {
                "htmlReports": [
                  {
                    "reportDir": "app/build/reports/tests/devDebug/",
                    "reportFiles": "index.html",
                    "reportName": "Unit test report"
                  }
                ]
              }
            }
          },
          {
            "acceptance_tests": {
              "artifacts": [
                "app/build/outputs/apk/soundcloud-android-*-${PIPELINE_VERSION}-debug-*.apk",
                "app/build/outputs/apk/*androidTest*.apk",
                "app/build/outputs/apk/androidnetworkmanager-*.apk"
              ],
              "cmd": "./gradlew runLollipopTests",
              "plugins": {
                "htmlReports": [
                  {
                    "reportDir": "results/",
                    "reportFiles": "index.html",
                    "reportName": "Test Results"
                  },
                  {
                    "reportDir": "results/",
                    "reportFiles": "collection_index.html",
                    "reportName": "Collection Results"
                  }
                ],
                "extEmail": {
                  "content": "&lt;p&gt;${SCRIPT, template=&quot;random-gif.template&quot;}&lt;/p&gt;${SCRIPT, template=&quot;ios.template&quot;}"
                }
              },
              "test-reports": "results/xml/*.xml"
            }
          }
        ]
      ]
    },
    {
      "name": "performances",
      "jobs": [
        {
          "analyse_release": {
            "cmd": "./gradlew assembleRelease ndUpload ndGetProfile",
            "manual": true,
            "schedule": "H 3 * * 2-6"
          }
        }
      ]
    },
    {
      "name": "deploy",
      "jobs": [
        {
          "deploy_alpha": {
            "cmd": "./scripts/pull_all_translations.sh && ./gradlew buildAlpha deployAlpha",
            "manual": true,
            "schedule": "H 3 * * 2-6",
            "artifacts": [
              "app/build/outputs/apk/app-prod-alpha.apk"
            ]
          }
        }
      ]
    },
    {
      "name": "statistics",
      "jobs": [
        {
          "daily_acceptance_test_statistics": {
            "cmd": "./scripts/acceptance_test_slack_stats.sh",
            "manual": true,
            "schedule": "H 09 * * 2-6"
          }
        }
      ]
    },
    {
      "name": "nightly_acceptance_tests",
      "jobs": [
        {
          "release_build_of_master_branch_acceptance_tests": {
            "cmd": "BUILD_TYPE=preRelease ./gradlew buildPreRelease assembleAcceptanceTest downloadNetworkManagerApkCI runLollipopTestsRelease && ./scripts/release_build_of_master_branch_acceptance_tests_report.sh",
            "manual": true,
            "schedule": "H 04 * * 2-6",
            "artifacts": [
              "app/build/outputs/apk/soundcloud-android-*-${PIPELINE_VERSION}-preRelease-*.apk",
              "app/build/outputs/apk/*androidTest*.apk",
              "app/build/outputs/apk/androidnetworkmanager-*.apk"
            ],
            "plugins": {
              "htmlReports": [
                {
                  "reportDir": "results/",
                  "reportFiles": "index.html",
                  "reportName": "Test Results"
                },
                {
                  "reportDir": "results/",
                  "reportFiles": "collection_index.html",
                  "reportName": "Collection Results"
                }
              ],
              "extEmail": {
                "content": "&lt;p&gt;${SCRIPT, template=&quot;random-gif.template&quot;}&lt;/p&gt;${SCRIPT, template=&quot;ios.template&quot;}"
              }
            },
            "test-reports": "results/xml/*.xml"
          }
        }
      ]
    }
  ],
  "settings": {
    "default-name": "Android_Listeners_Master",
    "git-url": "git@github.com:soundcloud/android-listeners.git",
    "github-url": "https://github.com/soundcloud/android-listeners/",
    "jenkins-server": "http://mobile-jenkins.int.s-cloud.net",
    "owner-emails": "android-dev@soundcloud.com",
    "slave-label": "mobile-slave"
  }
}
