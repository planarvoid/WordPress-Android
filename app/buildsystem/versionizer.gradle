import java.util.regex.Pattern

task incrementVersionCode {
  // Increments version code in the AndroidManifest.xml file of the main app
  doLast {
    def manifestFile = file(rootProject.ext.manifestSrcFile)
    def manifestText = manifestFile.getText()
    def patternVersionCode = Pattern.compile('versionCode=\"(\\d+)\"')
    def matcherVersionCode = patternVersionCode.matcher(manifestText)
    matcherVersionCode.find()

    def manifestContent = matcherVersionCode.replaceAll('versionCode=\"' + project.ext.versionCode + '\"')

    manifestFile.write(manifestContent)
  }
}

task setAlphaVersionCode {
  // Sets version code in the AndroidManifest.xml file of the main app to arbitrary value
  doLast {
    def manifestFile = file('AndroidManifest.xml')
    def matcherVersionCode = Pattern.compile('versionCode=\"(\\d+)\"').matcher( manifestFile.getText())
    matcherVersionCode.find()
    manifestFile.write(matcherVersionCode.replaceAll('versionCode=\"' + 1000 + '\"'))
  }
}

task incrementVersionName {
  // Increments version name in the AndroidManifest.xml file of the main app
  doLast {
    def manifestFile = file('AndroidManifest.xml')
    def manifestText = manifestFile.getText()
    def patternVersionNumber = Pattern.compile("versionName=\"(\\d+)\\.(\\d+)\\.(\\d+)\"")
    def matcherVersionNumber = patternVersionNumber.matcher(manifestText)
    matcherVersionNumber.find()

    def manifestContent = matcherVersionNumber.replaceAll('versionName=\"' + project.ext.versionName + '\"')

    manifestFile.write(manifestContent)
  }
}
